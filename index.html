<!doctype html>
<html lang="kk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Python Арқан Тартыс</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
      body {
        font-family: "Nunito", sans-serif;
        background-color: #f0f9ff;
      }
      .numpad-btn {
        transition: all 0.1s;
      }
      .numpad-btn:active {
        transform: scale(0.95);
      }
      .question-code {
        font-family: "Courier New", monospace;
      }
      .shake {
        animation: shake 0.5s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
      }
      @keyframes shake {
        10%,
        90% {
          transform: translate3d(-1px, 0, 0);
        }
        20%,
        80% {
          transform: translate3d(2px, 0, 0);
        }
        30%,
        50%,
        70% {
          transform: translate3d(-4px, 0, 0);
        }
        40%,
        60% {
          transform: translate3d(4px, 0, 0);
        }
      }
      .rope-container {
        transition: transform 0.7s cubic-bezier(0.34, 1.56, 0.64, 1);
      }
    </style>
  </head>
  <body class="min-h-screen flex flex-col items-center justify-center p-4">
    <!-- Header -->
    <div class="text-center mb-8 z-10">
      <h1
        class="text-4xl md:text-6xl font-black text-blue-900 mb-2 uppercase tracking-wider"
      >
        Python Арқан Тартыс
      </h1>
      <p class="text-slate-500 font-medium text-lg">
        Есепті шығарып, арқанды өзіңе қарай тарт!
      </p>
    </div>

    <!-- Game Area -->
    <div
      class="w-full max-w-7xl grid grid-cols-1 lg:grid-cols-3 gap-8 items-center"
    >
      <!-- Left Player Panel -->
      <div
        class="bg-white rounded-2xl shadow-xl p-6 flex flex-col items-center order-2 lg:order-1 transition-transform duration-300"
        id="panel-left"
      >
        <div
          class="w-full bg-blue-900 text-white rounded-xl px-6 py-4 mb-4 text-center shadow-md"
        >
          <span class="text-sm opacity-80 block mb-1">Python нәтижесі?</span>
          <code class="text-2xl font-bold question-code" id="q-left">...</code>
        </div>
        <div class="w-full mb-4">
          <div
            class="w-full bg-slate-100 border-2 border-slate-200 rounded-xl h-16 flex items-center justify-center text-3xl font-bold text-slate-800"
            id="ans-left"
          ></div>
        </div>
        <!-- Numpad Left -->
        <div class="grid grid-cols-3 gap-3 w-full max-w-[260px]">
          <button
            onclick="input('left', '1')"
            class="numpad-btn bg-white border-2 border-slate-200 rounded-xl h-14 text-xl font-bold hover:bg-slate-50"
          >
            1
          </button>
          <button
            onclick="input('left', '2')"
            class="numpad-btn bg-white border-2 border-slate-200 rounded-xl h-14 text-xl font-bold hover:bg-slate-50"
          >
            2
          </button>
          <button
            onclick="input('left', '3')"
            class="numpad-btn bg-white border-2 border-slate-200 rounded-xl h-14 text-xl font-bold hover:bg-slate-50"
          >
            3
          </button>
          <button
            onclick="input('left', '4')"
            class="numpad-btn bg-white border-2 border-slate-200 rounded-xl h-14 text-xl font-bold hover:bg-slate-50"
          >
            4
          </button>
          <button
            onclick="input('left', '5')"
            class="numpad-btn bg-white border-2 border-slate-200 rounded-xl h-14 text-xl font-bold hover:bg-slate-50"
          >
            5
          </button>
          <button
            onclick="input('left', '6')"
            class="numpad-btn bg-white border-2 border-slate-200 rounded-xl h-14 text-xl font-bold hover:bg-slate-50"
          >
            6
          </button>
          <button
            onclick="input('left', '7')"
            class="numpad-btn bg-white border-2 border-slate-200 rounded-xl h-14 text-xl font-bold hover:bg-slate-50"
          >
            7
          </button>
          <button
            onclick="input('left', '8')"
            class="numpad-btn bg-white border-2 border-slate-200 rounded-xl h-14 text-xl font-bold hover:bg-slate-50"
          >
            8
          </button>
          <button
            onclick="input('left', '9')"
            class="numpad-btn bg-white border-2 border-slate-200 rounded-xl h-14 text-xl font-bold hover:bg-slate-50"
          >
            9
          </button>
          <button
            onclick="clearInput('left')"
            class="numpad-btn bg-red-500 text-white rounded-xl h-14 text-xl font-bold hover:bg-red-600"
          >
            C
          </button>
          <button
            onclick="input('left', '0')"
            class="numpad-btn bg-white border-2 border-slate-200 rounded-xl h-14 text-xl font-bold hover:bg-slate-50"
          >
            0
          </button>
          <button
            onclick="submitAnswer('left')"
            class="numpad-btn bg-blue-500 text-white rounded-xl h-14 text-xl font-bold hover:bg-blue-600"
          >
            Go
          </button>
        </div>
      </div>

      <!-- Rope Section -->
      <div
        class="relative h-64 flex items-center justify-center overflow-hidden order-1 lg:order-2"
      >
        <!-- Center Line -->
        <div
          class="absolute top-0 bottom-0 left-1/2 w-1 border-l-4 border-dashed border-slate-300 z-0 h-full transform -translate-x-1/2"
        ></div>

        <!-- Rope Container -->
        <div
          id="rope-container"
          class="rope-container flex items-center justify-center z-10 relative"
        >
          <!-- Simple CSS Drawing for characters if image fails, or use placeholder -->
          <img
            src="./tug-of-war.png"
            onerror="
              this.src = 'https://placehold.co/600x400/png?text=Tug+of+War'
            "
            alt="Tug of War"
            class="max-h-52 drop-shadow-2xl"
          />
        </div>
      </div>

      <!-- Right Player Panel -->
      <div
        class="bg-white rounded-2xl shadow-xl p-6 flex flex-col items-center order-3 lg:order-3 transition-transform duration-300"
        id="panel-right"
      >
        <div
          class="w-full bg-red-800 text-white rounded-xl px-6 py-4 mb-4 text-center shadow-md"
        >
          <span class="text-sm opacity-80 block mb-1">Python нәтижесі?</span>
          <code class="text-2xl font-bold question-code" id="q-right">...</code>
        </div>
        <div class="w-full mb-4">
          <div
            class="w-full bg-slate-100 border-2 border-slate-200 rounded-xl h-16 flex items-center justify-center text-3xl font-bold text-slate-800"
            id="ans-right"
          ></div>
        </div>
        <!-- Numpad Right -->
        <div class="grid grid-cols-3 gap-3 w-full max-w-[260px]">
          <button
            onclick="input('right', '1')"
            class="numpad-btn bg-white border-2 border-slate-200 rounded-xl h-14 text-xl font-bold hover:bg-slate-50"
          >
            1
          </button>
          <button
            onclick="input('right', '2')"
            class="numpad-btn bg-white border-2 border-slate-200 rounded-xl h-14 text-xl font-bold hover:bg-slate-50"
          >
            2
          </button>
          <button
            onclick="input('right', '3')"
            class="numpad-btn bg-white border-2 border-slate-200 rounded-xl h-14 text-xl font-bold hover:bg-slate-50"
          >
            3
          </button>
          <button
            onclick="input('right', '4')"
            class="numpad-btn bg-white border-2 border-slate-200 rounded-xl h-14 text-xl font-bold hover:bg-slate-50"
          >
            4
          </button>
          <button
            onclick="input('right', '5')"
            class="numpad-btn bg-white border-2 border-slate-200 rounded-xl h-14 text-xl font-bold hover:bg-slate-50"
          >
            5
          </button>
          <button
            onclick="input('right', '6')"
            class="numpad-btn bg-white border-2 border-slate-200 rounded-xl h-14 text-xl font-bold hover:bg-slate-50"
          >
            6
          </button>
          <button
            onclick="input('right', '7')"
            class="numpad-btn bg-white border-2 border-slate-200 rounded-xl h-14 text-xl font-bold hover:bg-slate-50"
          >
            7
          </button>
          <button
            onclick="input('right', '8')"
            class="numpad-btn bg-white border-2 border-slate-200 rounded-xl h-14 text-xl font-bold hover:bg-slate-50"
          >
            8
          </button>
          <button
            onclick="input('right', '9')"
            class="numpad-btn bg-white border-2 border-slate-200 rounded-xl h-14 text-xl font-bold hover:bg-slate-50"
          >
            9
          </button>
          <button
            onclick="clearInput('right')"
            class="numpad-btn bg-red-500 text-white rounded-xl h-14 text-xl font-bold hover:bg-red-600"
          >
            C
          </button>
          <button
            onclick="input('right', '0')"
            class="numpad-btn bg-white border-2 border-slate-200 rounded-xl h-14 text-xl font-bold hover:bg-slate-50"
          >
            0
          </button>
          <button
            onclick="submitAnswer('right')"
            class="numpad-btn bg-blue-500 text-white rounded-xl h-14 text-xl font-bold hover:bg-blue-600"
          >
            Go
          </button>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script>
      // Game Config
      const WINNING_SCORE = 50;
      const SCORE_STEP = 10;
      let position = 0;

      // State
      const state = {
        left: { question: null, answer: "" },
        right: { question: null, answer: "" },
      };

      // Question Generator
      function generateQuestion() {
        const types = [
          "math_basic",
          "math_adv",
          "len_str",
          "bool_logic",
          "list_op",
          "str_method",
        ];
        const type = types[Math.floor(Math.random() * types.length)];

        if (type === "math_basic") {
          const a = Math.floor(Math.random() * 12) + 1;
          const b = Math.floor(Math.random() * 12) + 1;
          const ops = ["+", "-", "*"];
          const op = ops[Math.floor(Math.random() * ops.length)];
          let ans = 0;
          if (op === "+") ans = a + b;
          if (op === "-") ans = a - b;
          if (op === "*") ans = a * b;
          return { code: `print(${a} ${op} ${b})`, answer: ans.toString() };
        }

        if (type === "math_adv") {
          const a = Math.floor(Math.random() * 20) + 5;
          const b = Math.floor(Math.random() * 5) + 2;
          const ops = ["//", "%"];
          const op = ops[Math.floor(Math.random() * ops.length)];
          let ans = 0;
          if (op === "//") ans = Math.floor(a / b);
          if (op === "%") ans = a % b;
          return { code: `print(${a} ${op} ${b})`, answer: ans.toString() };
        }

        if (type === "len_str") {
          const words = ["az", "kz", "python", "code", "ok"];
          const word = words[Math.floor(Math.random() * words.length)];
          const mult = Math.floor(Math.random() * 3) + 1;
          return {
            code: `print(len("${word}" * ${mult}))`,
            answer: (word.length * mult).toString(),
          };
        }

        if (type === "bool_logic") {
          if (Math.random() < 0.5) {
            const val = Math.random() > 0.5;
            return {
              code: `print(int(${val ? "True" : "False"}))`,
              answer: val ? "1" : "0",
            };
          } else {
            const a = Math.floor(Math.random() * 10);
            const b = Math.floor(Math.random() * 10);
            return {
              code: `print(int(${a} > ${b}))`,
              answer: a > b ? "1" : "0",
            };
          }
        }

        if (type === "list_op") {
          const list = [10, 20, 30, 40, 50, 60];
          const idx = Math.floor(Math.random() * 4);
          return {
            code: `a=[${list}]; print(a[${idx}])`,
            answer: list[idx].toString(),
          };
        }

        // Fallback
        return { code: "print(1 + 1)", answer: "2" };
      }

      // Initialize
      function init() {
        state.left.question = generateQuestion();
        state.right.question = generateQuestion();
        render();
      }

      // Render
      function render() {
        document.getElementById("q-left").innerText = state.left.question.code;
        document.getElementById("q-right").innerText =
          state.right.question.code;
        document.getElementById("ans-left").innerText = state.left.answer;
        document.getElementById("ans-right").innerText = state.right.answer;

        // Update rope position
        const translateVal = position * 4;
        document.getElementById("rope-container").style.transform =
          `translateX(${translateVal}px)`;
      }

      // Input Handler
      window.input = function (side, val) {
        if (state[side].answer.length < 5) {
          state[side].answer += val;
          render();
        }
      };

      window.clearInput = function (side) {
        state[side].answer = "";
        render();
      };

      window.submitAnswer = function (side) {
        const isLeft = side === "left";
        const q = state[side].question;
        const ans = state[side].answer;

        if (ans === q.answer) {
          // Correct
          const direction = isLeft ? -1 : 1;
          position += direction * SCORE_STEP;

          // Visual feedback
          const panel = document.getElementById(`panel-${side}`);
          panel.classList.add("ring-4", "ring-green-500", "scale-105");
          setTimeout(
            () =>
              panel.classList.remove("ring-4", "ring-green-500", "scale-105"),
            300,
          );

          // Reset question
          state[side].question = generateQuestion();
          state[side].answer = "";

          checkWin();
        } else {
          // Wrong
          const panel = document.getElementById(`panel-${side}`);
          panel.classList.add("shake", "ring-4", "ring-red-500");
          setTimeout(
            () => panel.classList.remove("shake", "ring-4", "ring-red-500"),
            500,
          );
          state[side].answer = "";
        }
        render();
      };

      function checkWin() {
        if (Math.abs(position) >= WINNING_SCORE) {
          const winner =
            position <= -WINNING_SCORE ? "Көк команда" : "Қызыл команда";
          confetti({
            particleCount: 150,
            spread: 70,
            origin: { y: 0.6 },
          });

          // Show win message
          const overlay = document.createElement("div");
          overlay.className =
            "fixed inset-0 bg-black/50 flex items-center justify-center z-50";
          overlay.innerHTML = `
                    <div class="bg-white p-10 rounded-3xl text-center animate-bounce">
                        <h2 class="text-4xl font-black text-blue-900 mb-4">${winner} Жеңді!</h2>
                        <button onclick="location.reload()" class="bg-blue-600 text-white px-8 py-3 rounded-xl font-bold text-xl hover:bg-blue-700">Қайта ойнау</button>
                    </div>
                `;
          document.body.appendChild(overlay);
        }
      }

      init();
    </script>
  </body>
</html>
